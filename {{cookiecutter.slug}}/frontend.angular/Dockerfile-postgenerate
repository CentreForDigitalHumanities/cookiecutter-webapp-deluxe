FROM node:18 as bootstrap

WORKDIR /usr/src/app
RUN yarn init -yp && \
    yarn add "@angular/cli@17" && \
    yarn ng new {{cookiecutter.npm_slug}} \
        --prefix={{cookiecutter.app_prefix}} \
        --ssr \
        --skip-git=true \
        --skip-install=true \
        --package-manager=yarn \
        --style=scss \
        --routing=true

WORKDIR /usr/src/app/{{cookiecutter.npm_slug}}
COPY . .

VOLUME /usr/src/app/frontend
CMD cp package.json package.overwrite.json ../frontend/

FROM bootstrap as bootstrap-2

WORKDIR /usr/src/app/{{cookiecutter.npm_slug}}
COPY package.json ./
RUN rm src/favicon.ico .editorconfig && \
    yarn && \
    yarn ng add @angular/localize --skip-confirmation

VOLUME /usr/src/app/frontend
CMD cp angular.json angular.overwrite.json ../frontend/

FROM bootstrap-2 as bootstrap-3

WORKDIR /usr/src/app/{{cookiecutter.npm_slug}}
COPY angular.json ./
RUN yarn ng extract-i18n --output-path locale

VOLUME /usr/src/app/frontend
CMD cp -r * .* ../frontend/
